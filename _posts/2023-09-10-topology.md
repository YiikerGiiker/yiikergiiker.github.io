---
layout: post
title: "Topology"
description: "Topology is an Easy rated Linux machine on HTB."
categories: [CTF,HTB]
tags: [Linux,Easy]
author: g
---

## Nmap
![Pasted image 20240715110445.png](/images/Pasted image 20240715110445.png){: .normal }


## Initial foothold
On the main page there is a link to `http://latex.topology.htb/equation.php`.
![Pasted image 20240715110435.png](/images/Pasted image 20240715110435.png){: .normal width="600" }

Add the newly found domain and subdomain to the hosts file.
![Pasted image 20240715110431.png](/images/Pasted image 20240715110431.png){: .normal width="400" }

On the equation.php page we are able to enter LaTeX formulas.
![Pasted image 20240715110423.png](/images/Pasted image 20240715110423.png){: .normal width="500" }

Using ffuf we find a dev subdomain.
![Pasted image 20240715110417.png](/images/Pasted image 20240715110417.png){: .normal }

Add the new subdomain to hosts file too.
![Pasted image 20240715110412.png](/images/Pasted image 20240715110412.png){: .normal width="600" }

Trying to access `dev.topology.htb` results in a login prompt, info could be stored in a `.htpasswd` file?
![Pasted image 20240715110406.png](/images/Pasted image 20240715110406.png){: .normal width="500" }

Use a LaTeX formula for LFI: `/var/www/html/dev` returned an error, however `/var/www/dev` works!
![Pasted image 20240715110401.png](/images/Pasted image 20240715110401.png){: .normal }

Hash found.
![Pasted image 20240715110357.png](/images/Pasted image 20240715110357.png){: .normal }

Use JohnTheRipper to crack the hash: `calculus20`.
![Pasted image 20240715110351.png](/images/Pasted image 20240715110351.png){: .normal }

SSH: `vdaisley:calculus20`.
![Pasted image 20240715110346.png](/images/Pasted image 20240715110346.png){: .normal }


## Priv Esc
Linpeas reveals software that was put in the /opt directory.
![Pasted image 20240715110341.png](/images/Pasted image 20240715110341.png){: .normal width="500" }

Since we have write permissions in the gnuplot directory we can easily create a file with a reverse shell payload that will be executed as root.
![Pasted image 20240715110335.png](/images/Pasted image 20240715110335.png){: .normal }

After waiting for a few seconds we get a shell.
![Pasted image 20240715110328.png](/images/Pasted image 20240715110328.png){: .normal }


## User.txt
![Pasted image 20240715110322.png](/images/Pasted image 20240715110322.png){: .normal width="400" }


## Root.txt
![Pasted image 20240715110318.png](/images/Pasted image 20240715110318.png){: .normal width="400" }


## Pwned
![Pasted image 20240715110312.png](/images/Pasted image 20240715110312.png){: .normal }


### Sources
- [LaTeX injection](https://book.hacktricks.xyz/pentesting-web/formula-doc-latex-injection)
- [LaTeX injection wrapper](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection)
- [gnuplot priv esc](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/gnuplot-privilege-escalation/)