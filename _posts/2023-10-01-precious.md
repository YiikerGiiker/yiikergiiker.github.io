---
layout: post
title: "Precious"
description: "Precious is an Easy rated Linux machine on HTB."
categories: [CTF,HTB]
tags: [Linux,Easy]
author: g
---

## Nmap
![Pasted image 20240715104504.png](/images/Pasted image 20240715104504.png){: .normal }

Edit the hosts file, add the `precious.htb` domain.
![Pasted image 20240715104458.png](/images/Pasted image 20240715104458.png){: .normal width="500" }

## _**Initial Foothold**_

### Enumerating HTTP (Port 80)
![Pasted image 20240715104453.png](/images/Pasted image 20240715104453.png){: .normal width="500" }

After generating a pdf we can use exiftool to take a look at the metadata, pdf's are generated by `pdfkit v0.8.6`.
![Pasted image 20240715104447.png](/images/Pasted image 20240715104447.png){: .normal width="600" }

### Obtain shell
Start a webserver and a nc listener, afterwards run the following curl command to obtain a reverse shell.
![Pasted image 20240715104442.png](/images/Pasted image 20240715104442.png){: .normal }

Python server.
![Pasted image 20240715104438.png](/images/Pasted image 20240715104438.png){: .normal }

We gained a shell connection as the ruby user.
![Pasted image 20240715104432.png](/images/Pasted image 20240715104432.png){: .normal width="600" }


## _**Lateral Movement**_
We find the password of henry while enumerating files: `henry:Q3c1AqGHtoI0aXAYFH`.
![Pasted image 20240715104426.png](/images/Pasted image 20240715104426.png){: .normal width="600" }

SSH into the box as henry.
![Pasted image 20240715104422.png](/images/Pasted image 20240715104422.png){: .normal }


## _**Priv Esc**_
Sudo -l reveals a possible attack vector.
![Pasted image 20240715104418.png](/images/Pasted image 20240715104418.png){: .normal }

Looks like we might be able to put a reverse shell payload in a dependencies.yml file.
![Pasted image 20240715104413.png](/images/Pasted image 20240715104413.png){: .normal }

Source code reveals a vulnerable function used to open the dependenciesy.yml file: `YAML.load()`.
![Pasted image 20240715104407.png](/images/Pasted image 20240715104407.png){: .normal }

Create a dependencies.yml file with a bash reverse shell.
![Pasted image 20240715104402.png](/images/Pasted image 20240715104402.png){: .normal }


Script hangs after running.
![Pasted image 20240715104358.png](/images/Pasted image 20240715104358.png){: .normal }

The nc listener turned into a root shell.
![Pasted image 20240715104353.png](/images/Pasted image 20240715104353.png){: .normal width="600" }

## User.txt
![Pasted image 20240715104349.png](/images/Pasted image 20240715104349.png){: .normal width="400" }


## Root.txt
![Pasted image 20240715104345.png](/images/Pasted image 20240715104345.png){: .normal width="400" }


## You have PWNED
![Pasted image 20240715104339.png](/images/Pasted image 20240715104339.png){: .normal }


### Sources
- [pdfkit exploit](https://github.com/PurpleWaveIO/CVE-2022-25765-pdfkit-Exploit-Reverse-Shell?ref=www.ctfiot.com)
- [dependencies.yml exploit](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure%20Deserialization/Ruby.md)