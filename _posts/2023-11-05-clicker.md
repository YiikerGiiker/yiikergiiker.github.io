---
layout: post
title: "HTB Linux Medium: Clicker"
description: "Clicker is a Medium rated Linux machine on HTB."
categories: [CTF,HTB]
tags: [Linux,Medium]
author: g
---

## Nmap
![Pasted image 20240714210303.png](/images/Pasted image 20240714210303.png){: .normal }

## _**Initial Foothold**_
The web site redirects to the `clicker.htb` domain, add the domain to the hosts file:
![Pasted image 20240714210241.png](/images/Pasted image 20240714210241.png){: .normal width="400"}


### Enumerating NFS
Mount the drive locally to look through the files and folders on the share:
![Pasted image 20240714210246.png](/images/Pasted image 20240714210246.png){: .normal width="400"}

In the files we find the database username and password.
![Pasted image 20240714210235.png](/images/Pasted image 20240714210235.png){: .normal width="550"}


### Enumerating HTTP (Port 80)
When saving a game, only 2 attributes are used, however in the save_game.php file, there are 3 attributes present, if we are able to bypass the following if statement we would be able to save our profile and become an administrator on the website.
![Pasted image 20240714210229.png](/images/Pasted image 20240714210229.png){: .normal }

CRLF injection can be performed while saving a game to bypass the filter.
![Pasted image 20240714210224.png](/images/Pasted image 20240714210224.png){: .normal }

After logging out and logging back in we get access to the administrator page.
![Pasted image 20240714210220.png](/images/Pasted image 20240714210220.png){: .normal }

The nickname needs to be added to the save request or it will not show up in the administration portal.
![Pasted image 20240714210214.png](/images/Pasted image 20240714210214.png){: .normal }



### Gain RCE
We can replace the nickname with a PHP webshell.
![Pasted image 20240714210208.png](/images/Pasted image 20240714210208.png){: .normal }

In order to use the webshell we need to modify the file extension to `.php`. We do this by intercepting the request and changing the extension.
![Pasted image 20240714210203.png](/images/Pasted image 20240714210203.png){: .normal }

We now have RCE.
![Pasted image 20240714210159.png](/images/Pasted image 20240714210159.png){: .normal }



### Gain shell
RCE bash reverse shell payload (make sure to URL encode key characters).
![Pasted image 20240714210153.png](/images/Pasted image 20240714210153.png){: .normal }

Your nc listener is now a shell.
![Pasted image 20240714210148.png](/images/Pasted image 20240714210148.png){: .normal }



## _**Lateral movement**_
The execute_query script allows us to read files as the jack user, we are able to retrieve the private SSH key by specifying a relative path as the input.
![Pasted image 20240714210143.png](/images/Pasted image 20240714210143.png){: .normal width="600" }


Modify RSA key (otherwise invalid), donâ€™t forget: `chmod 600 id_rsa`!
![Pasted image 20240714210138.png](/images/Pasted image 20240714210138.png){: .normal width="600" }


SSH as jack:
![Pasted image 20240714210132.png](/images/Pasted image 20240714210132.png){: .normal }



## _**Priv Esc**_
Sudo -l output (IGNORE ALL:ALL).
![Pasted image 20240714210127.png](/images/Pasted image 20240714210127.png){: .normal }

Content of the monitor.sh script:
![Pasted image 20240714210122.png](/images/Pasted image 20240714210122.png){: .normal }


Create the following reverse shell script.
![Pasted image 20240714210118.png](/images/Pasted image 20240714210118.png){: .normal width="600" }

Execute the payload.
![Pasted image 20240714210114.png](/images/Pasted image 20240714210114.png){: .normal }

Start a Python server.
![Pasted image 20240714210109.png](/images/Pasted image 20240714210109.png){: .normal }

Your nc listener should have turned into a shell.
![Pasted image 20240714210105.png](/images/Pasted image 20240714210105.png){: .normal width="600" }


## User.txt
![Pasted image 20240714210050.png](/images/Pasted image 20240714210050.png){: .normal width="450"}


## Root.txt
![Pasted image 20240714210045.png](/images/Pasted image 20240714210045.png){: .normal width="400"}


## You have PWNED
![Pasted image 20240714210041.png](/images/Pasted image 20240714210041.png){: .normal }


### Sources
- [CRLF](https://www.acunetix.com/websitesecurity/crlf-injection/)
- [Perl priv-esc](https://www.elttam.com/blog/env/#content)